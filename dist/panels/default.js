"use strict";var e=require("vue");function b(n){return n.length===0?!1:n.length===1?!0:n.every(s=>s===n[0])}const _="-",I=2,z="1.0.0",w="tiny-inspector",M="i18n:tiny-inspector.description",C="./dist/main.js",L={"fs-extra":"^10.0.0",vue:"^3.1.4"},q={"@babel/cli":"^7.16.7","@babel/core":"^7.16.7","@babel/plugin-transform-modules-commonjs":"^7.16.7","@babel/preset-typescript":"^7.16.7","@types/fs-extra":"^9.0.5","@types/node":"^16.0.1","@vitejs/plugin-vue":"^2.2.2","@vitejs/plugin-vue-jsx":"^1.3.7","@vue/babel-plugin-jsx":"^1.1.1","@vue/devtools":"^6.0.12","cross-env":"^7.0.3",esbuild:"^0.14.23",prettier:"^2.5.1",rimraf:"^3.0.2",sass:"^1.49.8",typescript:"^4.3.4",vite:"^2.8.4"},A={default:{title:"tiny-inspector Default Panel",type:"dockable",main:"dist/panels/default.js",size:{"min-width":400,"min-height":300,width:600,height:600}},counter:{title:"tiny-inspector Counter Panel",type:"dockable",main:"dist/panels/counter.js",size:{"min-width":400,"min-height":300,width:800,height:600}}},j={menu:[{path:"i18n:menu.panel/tiny-inspector",label:"i18n:tiny-inspector.open_panel",message:"open-panel"}],messages:{"open-panel":{methods:["openPanel"]}},scene:{script:"dist/scene/index.js"}},S="Cocos Creator",D=">=3.4.0",k={"panels:build":"cross-env NODE_ENV=production node scripts/panels.js","common:build":"cross-env NODE_ENV=production node scripts/common.js"};var B={package_version:I,version:z,name:w,description:M,main:C,dependencies:L,devDependencies:q,panels:A,contributions:j,author:S,editor:D,scripts:k};function x(n,s){const r=n.map(l=>l[s]);return b(r)}function O(){const n=e.reactive({x:0,y:0,z:0}),s=e.ref([]),r=e.ref(null),l=e.ref(null),a=e.ref(null),m=()=>{const o=s.value;if(o.length===0)return;const i=o[0];if(o.length===1)n.x=i.x,n.y=i.y,n.z=i.z;else{const t=x(o,"x"),c=x(o,"y"),u=x(o,"z");n.x=t?i.x:_,n.y=c?i.y:_,n.z=u?i.z:_}r.value&&(r.value.$input.value=n.x),l.value&&(l.value.$input.value=n.y),a.value&&(a.value.$input.value=n.z)},h=async o=>{const t=s.value.find(v=>v.uuid===o);if(!t)return;const c=await Editor.Message.request("scene","query-node",o),{x:u,y:p,z:f}=c.position.value;t.x=u,t.y=p,t.z=f},g=async o=>{if(o.length===0){s.value=[];return}const i=[];for(const t of o){const c=await Editor.Message.request("scene","query-node",t),{x:u,y:p,z:f}=c.position.value,v={uuid:t,x:u,y:p,z:f};i.push(v)}s.value=i},y=async o=>{await g(o),m()},d=async(o,i,t)=>{o[i]=t;const{uuid:c,x:u,y:p,z:f}=o,v={x:u,y:p,z:f},P={name:B.name,method:"setNodePosition",args:[c,v]};await Editor.Message.request("scene","execute-scene-script",P)};return{position:n,nodesInfo:s,xInputRef:r,yInputRef:l,zInputRef:a,setNodesInfo:g,setPosition:m,updatePosition:y,updateNodeInfo:h,onPositionChange:async(o,i)=>{const t=s.value;if(t.length===0)return;const c=i.target.value;for(const u of t)n[o]=c,await d(u,o,c)}}}const V=e.defineComponent({name:"PositionProp",props:{uuids:{type:Array,required:!0,default:()=>[]}},setup(n){const{position:s,xInputRef:r,yInputRef:l,zInputRef:a,nodesInfo:m,updatePosition:h,updateNodeInfo:g,setPosition:y,onPositionChange:d}=O();e.watch(()=>n.uuids,async()=>{await h(n.uuids)},{immediate:!0}),e.onMounted(()=>{o()}),e.onUnmounted(()=>{i()});async function N(t){if(m.value.length===0)return h([t]);await g(t),y()}function o(){Editor.Message.addBroadcastListener("scene:change-node",N)}function i(){Editor.Message.removeBroadcastListener("scene:change-node",N)}return()=>e.createVNode("div",{class:"pos"},[e.createVNode("div",{class:"pos__label"},[e.createTextVNode("Position:")]),e.createVNode("ul",{class:"pos__fields"},[e.createVNode("li",{class:"pos__field"},[e.createVNode("span",null,[e.createTextVNode("x: ")]),e.createVNode(e.resolveComponent("ui-num-input"),{class:"pos__input",ref:r,step:"0.1",value:s.x,onchange:t=>d("x",t)},null)]),e.createVNode("li",{class:"pos__field"},[e.createVNode("span",null,[e.createTextVNode("y: ")]),e.createVNode(e.resolveComponent("ui-num-input"),{className:"pos__input",ref:l,step:"0.1",value:s.y,onchange:t=>d("y",t)},null)]),e.createVNode("li",{class:"pos__field"},[e.createVNode("span",null,[e.createTextVNode("z: ")]),e.createVNode(e.resolveComponent("ui-num-input"),{className:"pos__input",ref:a,step:"0.1",value:s.z,onchange:t=>d("z",t)},null)])])])}}),T=e.defineComponent({name:"App",components:{PositionProp:V},setup(){const n=e.ref([]);e.onMounted(async()=>{l(),s()}),e.onUnmounted(()=>{r()});function s(){Editor.Message.addBroadcastListener("selection:select",a),Editor.Message.addBroadcastListener("selection:unselect",a)}function r(){Editor.Message.removeBroadcastListener("selection:select",a),Editor.Message.removeBroadcastListener("selection:unselect",a)}function l(){a()}function a(){n.value=Editor.Selection.getSelected("node")}return()=>e.createVNode("div",{class:"inspector"},[e.createVNode("header",{class:"inspector__header"},[e.createTextVNode("Tiny Node Inspector")]),n.value.length>0?e.createVNode("main",{class:"inspector__content"},[e.createVNode(V,{uuids:n.value},null)]):e.createVNode("div",{class:"inspector__none"},[e.createTextVNode("You did not select any nodes")])])}});function R(){const n=e.createApp(T);return n.config.compilerOptions.isCustomElement=s=>s.startsWith("ui-"),n}var U=`.pos__item{display:flex}.pos__label{margin-right:10px}.pos__fields{display:flex}.pos__field{margin-right:10px}.pos__input{width:50px}
`;const E=new WeakMap;module.exports=Editor.Panel.define({listeners:{show(){console.log("show")},hide(){console.log("hide")}},template:'<div id="app"></div>',style:U,$:{app:"#app"},ready(){if(this.$.app){const n=R();n.mount(this.$.app),E.set(this,n)}},beforeClose(){},close(){const n=E.get(this);n&&n.unmount()},methods:{}});
